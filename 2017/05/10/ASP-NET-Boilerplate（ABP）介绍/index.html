<!doctype html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ASP.NET,DDD,ABP,领域驱动设计,ASP.NET Boilerplate," />





  <link rel="alternate" href="/atom.xml" title="coderPreacher's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="背景我们正在根据不同需求创建不同的应用程序。但是，至少在某种程度上一遍又一遍地实施共同和类似的结构。授权，验证，异常处理，日志记录，本地化，数据库连接管理，设置管理，审核日志记录是其中一些常见的结构。此外，我们正在建立架构结构和最佳实践，如分层和模块化架构，域驱动设计，依赖注入等。并试图根据一些惯例开发应用程序。 由于所有这些都是非常耗时且难以为每个项目建立单独的，许多公司创建私有框架。他们正在使">
<meta name="keywords" content="ASP.NET,DDD,ABP,领域驱动设计,ASP.NET Boilerplate">
<meta property="og:type" content="article">
<meta property="og:title" content="ASP.NET Boilerplate（ABP）介绍">
<meta property="og:url" content="http://yoursite.com/2017/05/10/ASP-NET-Boilerplate（ABP）介绍/index.html">
<meta property="og:site_name" content="coderPreacher's Blog">
<meta property="og:description" content="背景我们正在根据不同需求创建不同的应用程序。但是，至少在某种程度上一遍又一遍地实施共同和类似的结构。授权，验证，异常处理，日志记录，本地化，数据库连接管理，设置管理，审核日志记录是其中一些常见的结构。此外，我们正在建立架构结构和最佳实践，如分层和模块化架构，域驱动设计，依赖注入等。并试图根据一些惯例开发应用程序。 由于所有这些都是非常耗时且难以为每个项目建立单独的，许多公司创建私有框架。他们正在使">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/tasksystem.png">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/create_template_v2.png">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/project_files2.png">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/first_run.png">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/repository_interface2.png">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/migration.png">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/db_after_migration.png">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/calling_webapi_ajax.png">
<meta property="og:image" content="https://www.codeproject.com/KB/aspnet/768664/localization_files2.png">
<meta property="og:updated_time" content="2017-05-15T13:50:13.938Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ASP.NET Boilerplate（ABP）介绍">
<meta name="twitter:description" content="背景我们正在根据不同需求创建不同的应用程序。但是，至少在某种程度上一遍又一遍地实施共同和类似的结构。授权，验证，异常处理，日志记录，本地化，数据库连接管理，设置管理，审核日志记录是其中一些常见的结构。此外，我们正在建立架构结构和最佳实践，如分层和模块化架构，域驱动设计，依赖注入等。并试图根据一些惯例开发应用程序。 由于所有这些都是非常耗时且难以为每个项目建立单独的，许多公司创建私有框架。他们正在使">
<meta name="twitter:image" content="https://www.codeproject.com/KB/aspnet/768664/tasksystem.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":true,"scrollpercent":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/05/10/ASP-NET-Boilerplate（ABP）介绍/"/>





  <title>ASP.NET Boilerplate（ABP）介绍 | coderPreacher's Blog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">coderPreacher's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Love life, love technology, positive, optimistic, beyond the self</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            Commonweal 404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/10/ASP-NET-Boilerplate（ABP）介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="谢晖">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="coderPreacher's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">ASP.NET Boilerplate（ABP）介绍</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-10T23:11:12+08:00">
                2017-05-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ASP-NET/" itemprop="url" rel="index">
                    <span itemprop="name">ASP.NET</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/10/ASP-NET-Boilerplate（ABP）介绍/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/10/ASP-NET-Boilerplate（ABP）介绍/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>我们正在根据不同需求创建不同的应用程序。但是，至少在某种程度上一遍又一遍地实施共同和类似的结构。授权，验证，异常处理，日志记录，本地化，数据库连接管理，设置管理，审核日志记录是其中一些常见的结构。此外，我们正在建立架构结构和最佳实践，如分层和模块化架构，域驱动设计，依赖注入等。并试图根据一些惯例开发应用程序。</p>
<p>由于所有这些都是非常耗时且难以为每个项目建立单独的，许多公司创建私有框架。他们正在使用这些框架更少的错误来更快地开发新的应用程序。当然，并不是所有的公司都很幸运。他们大多数没有时间，预算和团队来发展这样的框架。即使他们有可能创建一个框架，很难记录，培训开发人员并维护它。</p>
<p>ASP.NET Boilerplate（ABP）是一个开放源码和文档良好的应用程序框架，开始了“为所有公司和所有开发人员制定通用框架”的想法。这不仅仅是一个框架，而且还提供了一个基于领驱动设计(DDD)和最佳实践的强大的架构模型。</p>
<p>“DRY——避免重复造轮子”，这也是ASP.NET Boilerplate（ABP）的重要思想，作者之所以把项目命名为“ASP.NET Boilerplate”，就是希望它能成为开发一般企业WEB应用的新起点，直接把ABP作为项目模板，避免做重复的工作，让开发人员只关注具体业务逻辑的实现，这样也大大提高了开发效率。</p>
<p>  使用框架当然有代价，你必须受到框架强API的侵入，抑或要使用他的方言。而且这个框架想要吃透，也要付出很大的学习成本。但是好处也是显而易见的。业界顶尖的架构师已经为你搭建好了一套基础架构，很好的回应了关于一个软件系统应该如何设计，如何规划的问题，并且提供了一套最佳实践和范例。</p>
<p>   学习虽然要付出成本，但是经过漫长的跋涉，我们从一无所知已经站到了工业级开发的门槛上。基于这个框架，我们可以很好的来划分任务，进行单元测试等。大大降低了软件出现BUG的几率。</p>
<h1 id="什么是ASP-NET-Boilerplate（ABP）？"><a href="#什么是ASP-NET-Boilerplate（ABP）？" class="headerlink" title="什么是ASP.NET Boilerplate（ABP）？"></a>什么是ASP.NET Boilerplate（ABP）？</h1><p>ASP.NET Boilerplate是使用最佳实践和最受欢迎工具的新型现代Web应用程序的起点。 它的目标是成为一个坚实的模型，通用应用程序框架和项目模板。 它能做什么？</p>
<h3 id="服务端-Server-side"><a href="#服务端-Server-side" class="headerlink" title="服务端(Server side)"></a>服务端(Server side)</h3><ul>
<li>基于最新的.NET技术 （目前是ASP.NET MVC 5、Web API 2、C# 5.0，在ASP.NET 5正式发布后会升级）</li>
<li>实现领域驱动设计（实体、仓储、领域服务、领域事件、应用服务、数据传输对象，工作单元等等）</li>
<li>实现分层体系结构（领域层，应用层，展现层和基础设施层）</li>
<li>提供了一个基础架构来开发可重用可配置的模块</li>
<li>集成一些最流行的开源框架/库，也许有些是你正在使用的。</li>
<li>提供了一个基础架构让我们很方便地使用依赖注入（使用Castle Windsor作为依赖注入的容器）</li>
<li>提供Repository仓储模式支持不同的ORM（已实现Entity Framework 、NHibernate、MangoDb和内存数据库）</li>
<li>支持并实现数据库迁移（EF 的 Code first）</li>
<li>模块化开发（每个模块有独立的EF DbContext，可单独指定数据库）</li>
<li>包括一个简单的和灵活的多语言/本地化系统</li>
<li>包括一个 EventBus来实现服务器端全局的领域事件</li>
<li>统一的异常处理（应用层几乎不需要处理自己写异常处理代码）</li>
<li>数据有效性验证（Asp.NET MVC只能做到Action方法的参数验证，ABP实现了Application层方法的参数有效性验证）</li>
<li>通过Application Services自动创建Web Api层（不需要写ApiController层了）</li>
<li>提供基类和帮助类让我们方便地实现一些常见的任务</li>
<li>使用“约定优于配置原则”</li>
</ul>
<h3 id="客户端-Client-side"><a href="#客户端-Client-side" class="headerlink" title="客户端(Client side)"></a>客户端(Client side)</h3><ul>
<li>提供单页面应用程序（使用AngularJs和Durandaljs）和多页面应用程序的项目模板。 模板基于Twitter Bootstrap。</li>
<li>大多数使用的JavaScript库都包含在默认情况下配置的。</li>
<li>创建动态JavaScript代理来轻松调用应用程序服务（使用动态Web API层）。</li>
<li>封装一些Javascript 函数：显示警报和通知，阻止UI，制作AJAX请求…</li>
</ul>
<p>除了这些共同的基础设施，正在开发一个名为“Zero”的模块。 它将提供基于角色和权限的授权系统（使用最新的ASP.NET身份框架），设置系统，多租户，审计日志等。</p>
<h1 id="ABP不是什么？"><a href="#ABP不是什么？" class="headerlink" title="ABP不是什么？"></a>ABP不是什么？</h1><p>ASP.NET Boilerplate提供了具有最佳实践的应用程序开发模型。 它具有基础类，接口和工具，使得易于构建可维护的大规模应用程序。</p>
<ul>
<li>但它不是RAD（快速应用程序开发）工具之一，它们尝试为无需编码的应用程序提供基础架构。 相反，它提供了一个基础设施来编写最佳实践。</li>
<li>它不是代码生成工具。 虽然它具有在运行时构建动态代码的几个功能，但它不生成代码。</li>
<li>这不是一个一体化的框架。 相反，它为特定任务使用了众所周知的工具/库（如用于O / RM的NHibernate和EntityFramework，用于日志记录的Log4Net，作为DI容器的Castle Windsor，SPA框架的AngularJS）。</li>
</ul>
<h1 id="入门-Getting-started"><a href="#入门-Getting-started" class="headerlink" title="入门(Getting started)"></a>入门(Getting started)</h1><p>在本文中，我将展示如何使用ASP.NET Boilerplate去除单页面和响应性Web应用程序（我现在称之为ABP）。 我将在这里使用DurandalJs作为SPA框架和NHibernate作为ORM框架。 我准备了另一篇用AngularJs和EntityFramework实现相同应用的文章。</p>
<p>此示例应用程序被命名为“简单任务系统”，它由两个页面组成：一个用于列出任务，另一个是添加新任务。 一个任务可以与一个人相关，可以是活动的或完成的。 应用程序以两种语言进行本地化。 应用程序中任务列表的屏幕截图如下所示：<br><img src="https://www.codeproject.com/KB/aspnet/768664/tasksystem.png" alt="task"></p>
<h2 id="从模板创建空的web应用程序"><a href="#从模板创建空的web应用程序" class="headerlink" title="从模板创建空的web应用程序"></a>从模板创建空的web应用程序</h2><p>ABP为新项目提供启动模板（即使您可以手动创建项目并从nuget获取ABP包，模板方式更容易）。 请访问<a href="www.aspnetboilerplate.com/Templates">www.aspnetboilerplate.com/Templates</a>以从模板创建应用程序。 您可以选择具有可选AngularJs或DurandalJs的SPA（单页面应用）项目。 或者您可以选择MPA（经典的，多页面应用程序）项目。 那么你可以选择EntityFramework或NHibernate作为ORM框架。</p>
<p><img src="https://www.codeproject.com/KB/aspnet/768664/create_template_v2.png" alt="create_template_v2"></p>
<p>我将我的项目命名为SimpleTaskSystem，并与Durandal和NHibernate建立了一个SPA项目。 下载项目为zip文件。 当我打开zip文件时，我看到一个解决方案已经准备好，包含每个域驱动设计层的程序集（项目）：<br><img src="https://www.codeproject.com/KB/aspnet/768664/project_files2.png" alt="project_files2"></p>
<p>就这样，你的项目已经准备好运行了！ 在VS2013中打开它，然后按F5：<br><img src="https://www.codeproject.com/KB/aspnet/768664/first_run.png" alt="first_run"></p>
<h2 id="领域层-Domain-layer"><a href="#领域层-Domain-layer" class="headerlink" title="领域层(Domain layer)"></a>领域层(Domain layer)</h2><p>“<em>负责代表业务概念，有关业务情况的信息和业务规则</em>”（Eric Evans）。 在领域驱动设计（DDD）中，核心层是领域层。 领域层定义您的实体，实现您的业务规则等。</p>
<h3 id="实体-Entities"><a href="#实体-Entities" class="headerlink" title="实体(Entities)"></a>实体(Entities)</h3><p>实体是DDD的核心概念之一。 埃里克·埃文斯（Eric Evans）将其描述为“一个不是由其属性从根本上定义的对象，而是一个连贯性和身份的线索”。 因此，实体具有Id并存储在数据库中。</p>
<p>任务(Task)实体类定义如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public class Task : Entity&lt;long&gt;</div><div class="line">&#123;</div><div class="line">    public virtual Person AssignedPerson &#123; get; set; &#125;</div><div class="line"></div><div class="line">    public virtual string Description &#123; get; set; &#125;</div><div class="line"></div><div class="line">    public virtual DateTime CreationTime &#123; get; set; &#125;</div><div class="line"></div><div class="line">    public virtual TaskState State &#123; get; set; &#125;</div><div class="line"></div><div class="line">    public Task()</div><div class="line">    &#123;</div><div class="line">        CreationTime = DateTime.Now;</div><div class="line">        State = TaskState.Active;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>它是从具有长主键类型的实体基类派生的简单类。 TaskState是一个具有“Active”和“Completed”的枚举。</p>
<p>人(Person)实体类定义如下：<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span> : <span class="title">Entity</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>任务与一个人有关系，这就是这个简单的应用。</p>
<p>实体在ABP中必须实现IEntity <tprimarykey>接口。 因此，如果主键的类型是Long，则必须实现IEntity <long>。 如果您的Entity的主键是int，您无需定义主键类型并直接实现IEntity接口。 实际上，您可以轻松地从Entity或Entity <tprimarykey>派生（如上图所示）（Task和Person）。 IEntity定义了Entity的Id属性。</tprimarykey></long></tprimarykey></p>
<h3 id="仓储-Repositories"><a href="#仓储-Repositories" class="headerlink" title="仓储(Repositories)"></a>仓储(Repositories)</h3><p>“使用类收集接口访问领域对象，在领域和数据映射层之间进行中介”（Martin Fowler）。 实际上，仓储用于对域对象（实体或值类型）执行数据库操作。</p>
<p>通常，每个实体（或聚合根）使用分隔的仓储。 ASP.NET Boilerplate为每个实体提供默认仓储（我们将看到如何使用默认仓储）。 如果我们需要定义其他方法，我们可以扩展IRepository接口。 我将其扩展到了Task库：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface ITaskRepository : IRepository&lt;Task, long&gt;</div><div class="line">&#123;</div><div class="line">    List&lt;Task&gt; GetAllWithPeople(int? assignedPersonId, TaskState? state);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>为每个Repository定义一个接口是很好的。 因此，我们可以将接口与实现分开。 仓储接口定义了仓储的常见方法：</p>
<p><img src="https://www.codeproject.com/KB/aspnet/768664/repository_interface2.png" alt="first_run"></p>
<p>它定义了基本的CRUD方法。 所以，所有仓储都会自动实现所有这些方法。 除了标准的基础方法之外，还可以添加特定于该仓储的方法，就像我定义了GetAllWithPeople方法一样。</p>
<h2 id="基础设施层-Infrastructure-layer"><a href="#基础设施层-Infrastructure-layer" class="headerlink" title="基础设施层(Infrastructure layer)"></a>基础设施层(Infrastructure layer)</h2><p>“提供支持更高层次的通用技术功能”（Eric Evans）。 它用于使用第三方库和框架（如对象关系映射）实现应用程序的抽象。 在这个应用程序中，我将使用基础设施层：</p>
<ul>
<li>使用FluentMigrator创建数据库迁移系统。</li>
<li>实现存储库并使用NHibernate和FluentNHibernate映射实体。</li>
</ul>
<h3 id="数据库迁移-Database-Migrations"><a href="#数据库迁移-Database-Migrations" class="headerlink" title="数据库迁移(Database Migrations)"></a>数据库迁移(Database Migrations)</h3><p>“进化数据库设计：在过去几年中，我们开发了许多技术，允许数据库设计随着应用程序的发展而发展，这对于敏捷方法来说是非常重要的。” Martin Fowler在他的网站中说。 数据库迁移是支持这一想法的重要技术。 在没有这种技术的情况下，很难在多个生产环境中维护应用程序的数据库。 即使你只有一个在线系统，这是至关重要的。</p>
<p>FluentMigrator 是数据库迁移的好工具。 它支持大多数常见的数据库系统。 在这里，我的迁移代码为Person和Task表。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[Migration(2014041001)]</div><div class="line">public class _01_CreatePersonTable : AutoReversingMigration</div><div class="line">&#123;</div><div class="line">    public override void Up()</div><div class="line">    &#123;</div><div class="line">        Create.Table("StsPeople")</div><div class="line">            .WithColumn("Id").AsInt32().Identity().PrimaryKey().NotNullable()</div><div class="line">            .WithColumn("Name").AsString(32).NotNullable();</div><div class="line"></div><div class="line">        Insert.IntoTable("StsPeople")</div><div class="line">            .Row(new &#123; Name = "Douglas Adams" &#125;)</div><div class="line">            .Row(new &#123; Name = "Isaac Asimov" &#125;)</div><div class="line">            .Row(new &#123; Name = "George Orwell" &#125;)</div><div class="line">            .Row(new &#123; Name = "Thomas More" &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">[Migration(2014041002)]</div><div class="line">public class _02_CreateTasksTable : AutoReversingMigration</div><div class="line">&#123;</div><div class="line">    public override void Up()</div><div class="line">    &#123;</div><div class="line">        Create.Table("StsTasks")</div><div class="line">            .WithColumn("Id").AsInt64().Identity().PrimaryKey().NotNullable()</div><div class="line">            .WithColumn("AssignedPersonId").AsInt32().ForeignKey("TsPeople", "Id").Nullable()</div><div class="line">            .WithColumn("Description").AsString(256).NotNullable()</div><div class="line">            .WithColumn("State").AsByte().NotNullable().WithDefaultValue(1) //1: TaskState.New</div><div class="line">            .WithColumn("CreationTime").AsDateTime().NotNullable().WithDefault(SystemMethods.CurrentDateTime);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在FluentMigrator中，迁移在从Migration派生的类中定义。 如果您的迁移可以自动回滚，AutoReversingMigration是一个快捷方式。 迁移类应该具有MigrationAttribute。 它定义了迁移类的版本号。 所有迁移都按此版本号排序。 它可以是任何长的数字。 我使用一个标识迁移类创建日期的数字加上同一天的增量值（例如：2014年4月24日第二个迁移类，版本为“2014042402”）。 这完全取决于你 只有重要的是他们的相对秩序。</p>
<p>FluentMigrator将最新的应用版本号存储在数据库的表中。 因此，它仅适用于那些大于数据库版本的迁移。 默认情况下，它使用’VersionInfo’表。 如果要更改表名，可以创建一个类：<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[VersionTableMetaData]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">VersionTable</span> : <span class="title">DefaultVersionTableMetaData</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">string</span> TableName</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">get</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"StsVersionInfo"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如你所见，我为所有表写了一个前缀Sts（简单任务系统）。 这对于模块化应用程序很重要，所以所有模块都可以使用其特定的前缀来标识模块特定的表。</p>
<p>要在数据库中创建表，我使用这种“命令行”命令使用FluentMigrator的Migrate.exe工具：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Migrate.exe /connection &quot;Server=localhost; Database=SimpleTaskSystemDb; Trusted_Connection=True;&quot; /db sqlserver /target &quot;SimpleTaskSystem.Infrastructure.NHibernate.dll&quot;</div></pre></td></tr></table></figure></p>
<p>对于快捷方式，ABP模板包含RunMigrations.bat文件。 在Debug模式下编译项目后，我运行“RunMigrations.bat”：</p>
<p><img src="https://www.codeproject.com/KB/aspnet/768664/migration.png" alt="migration"></p>
<p>正如你看到的，两种迁移文件执行，表创建：</p>
<p><img src="https://www.codeproject.com/KB/aspnet/768664/db_after_migration.png" alt="migration"></p>
<p>有关FluentMigrator的更多信息，请参阅它的网站。</p>
<h3 id="实体映射-Entity-mappings"><a href="#实体映射-Entity-mappings" class="headerlink" title="实体映射(Entity mappings)"></a>实体映射(Entity mappings)</h3><p>为了获取/存储实体到数据库中，我们应该使用数据库表映射实体。 NHibernate有几个选择可以实现。 在这里，我将使用Fluent Mapping手册（您可以使用传统的自动映射，请参阅FluentNHibernate的网站）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class PersonMap : EntityMap&lt;Person&gt;</div><div class="line">&#123;</div><div class="line">    public PersonMap()</div><div class="line">        : base(&quot;StsPeople&quot;)</div><div class="line">    &#123;</div><div class="line">        Map(x =&gt; x.Name);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class TaskMap : EntityMap&lt;Task, long&gt;</div><div class="line">&#123;</div><div class="line">    public TaskMap()</div><div class="line">        : base(&quot;StsTasks&quot;)</div><div class="line">    &#123;</div><div class="line">        Map(x =&gt; x.Description);</div><div class="line">        Map(x =&gt; x.CreationTime);</div><div class="line">        Map(x =&gt; x.State).CustomType&lt;TaskState&gt;();</div><div class="line">        References(x =&gt; x.AssignedPerson).Column(&quot;AssignedPersonId&quot;).LazyLoad();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>EntityMap是一类ABP的自动映射Id属性，并在构造函数中获取表名。所以，我从它派生和映射等性能。</p>
<h3 id="仓储实现"><a href="#仓储实现" class="headerlink" title="仓储实现"></a>仓储实现</h3><p>我定义的接口为域中层任务储存库（ITaskRepository）。在这里，我将在这里NHibernate的实现它：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">public class TaskRepository : NhRepositoryBase&lt;Task, long&gt;, ITaskRepository</div><div class="line">&#123;</div><div class="line">    public List&lt;Task&gt; GetAllWithPeople(int? assignedPersonId, TaskState? state)</div><div class="line">    &#123;</div><div class="line">        //In repository methods, we do not deal with create/dispose DB connections (Session) and transactions. ABP handles it.</div><div class="line">            </div><div class="line">        var query = GetAll(); //GetAll() returns IQueryable&lt;T&gt;, so we can query over it.</div><div class="line">        //var query = Session.Query&lt;Task&gt;(); //Alternatively, we can directly use NHibernate&apos;s Session</div><div class="line">            </div><div class="line">        //Add some Where conditions...</div><div class="line"></div><div class="line">        if (assignedPersonId.HasValue)</div><div class="line">        &#123;</div><div class="line">            query = query.Where(task =&gt; task.AssignedPerson.Id == assignedPersonId.Value);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (state.HasValue)</div><div class="line">        &#123;</div><div class="line">            query = query.Where(task =&gt; task.State == state);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return query</div><div class="line">            .OrderByDescending(task =&gt; task.CreationTime)</div><div class="line">            .Fetch(task =&gt; task.AssignedPerson) //Fetch assigned person in a single query</div><div class="line">            .ToList();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>NhRepositoryBase实现了在IRepository界面中定义的所有方法。 所以，你必须实现你的自定义方法，因为我实现了GetAllWithPeople。</p>
<p>GetAll（）方法返回IQueryable <tentity>，所以你可以写额外的条件，直到调用ToList（）。</tentity></p>
<p>如果标准仓储方法足够用于该实体，则无需为实体定义或实现仓储。 所以，我没有为Person实体实现仓储。</p>
<h2 id="应用层-Application-layer"><a href="#应用层-Application-layer" class="headerlink" title="应用层(Application layer)"></a>应用层(Application layer)</h2><p>“定义软件应该做的工作，并指导表达领域的对象解决问题”（Eric Evans）。 应用层在理想应用中不包括域信息和业务规则（这在现实生活中可能是不可能的，但我们应该将其最小化）。 它介于表示层和域层之间。</p>
<h3 id="应用服务和数据传输对象（DTO）"><a href="#应用服务和数据传输对象（DTO）" class="headerlink" title="应用服务和数据传输对象（DTO）"></a>应用服务和数据传输对象（DTO）</h3><p>应用服务提供应用层的功能。 应用程序服务方法将数据传输对象作为参数，并返回数据传输对象。 直接返回的实体（或其他领域对象）有许多问题（如数据隐藏，序列化和延迟加载问题）。 我强烈建议不要从应用程序服务获取/返回实体或任何其他域对象。 他们应该只是返回DTO。 因此，显示（Presentation）层与领域（Domain）层完全隔离。</p>
<p>所以，让我们从简单的一，个人应用服务入手：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface IPersonAppService : IApplicationService</div><div class="line">&#123;</div><div class="line">    GetAllPeopleOutput GetAllPeople();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>所有应用程序服务按惯例执行IApplicationService。 它确保依赖注入，并提供一些ABP的内置功能（如验证，审核日志和授权）。 我只定义了一个名为GetAllPeople（）的方法，并返回一个名为GetAllPeopleOutput的DTO。 我将DTO命名为：方法名称加输入或输出后缀。 参见GetAllPeopleOutput类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public class GetAllPeopleOutput</div><div class="line">&#123;</div><div class="line">    public List&lt;PersonDto&gt; People &#123; get; set; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>PersonDto是将Person信息传递给表示层的另一个DTO类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[AutoMapFrom(typeof(Person))] //AutoMapFrom attribute maps Person -&gt; PersonDto</div><div class="line">public class PersonDto : EntityDto</div><div class="line">&#123;</div><div class="line">    public string Name &#123; get; set; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>EntityDto是另一个帮助类ABP，它定义了Id属性。 AutoMapFrom属性为AutoMapper创建Person到PersonDto的自动映射配置。 IPersonAppService的实现如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class PersonAppService : IPersonAppService //Optionally, you can derive from ApplicationService as we did for TaskAppService class.</div><div class="line">&#123;</div><div class="line">    private readonly IRepository&lt;Person&gt; _personRepository;</div><div class="line"></div><div class="line">    //ABP provides that we can directly inject IRepository&lt;Person&gt; (without creating any repository class)</div><div class="line">    public PersonAppService(IRepository&lt;Person&gt; personRepository)</div><div class="line">    &#123;</div><div class="line">        _personRepository = personRepository;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public GetAllPeopleOutput GetAllPeople()</div><div class="line">    &#123;</div><div class="line">        var people = await _personRepository.GetAllListAsync();</div><div class="line">        return new GetAllPeopleOutput</div><div class="line">                &#123;</div><div class="line">                    People = people.MapTo&lt;List&lt;PersonDto&gt;&gt;()</div><div class="line">                &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>PersonAppService在其构造函数中获取IRepository <person>作为参数。 ABP的内置依赖注入系统使用Castle Windsor处理它。 所有存储库和应用程序服务都会自动注册到IOC（控制反转）容器作为临时对象。 所以，你没有想到DI细节。 此外，ABP可以在不定义或实现存储库的情况下为实体创建标准存储库。</person></p>
<p>GetAllPeople（）方法只是从数据库中获取所有人（使用ABP的开箱即用）列表，并使用AutoMapper [6]库将其转换为PersonDto对象列表。 AutoMapper使得使用约定（如果需要的话）将一个类映射到另一个类是非常容易的。 ABP的MapTo扩展方法在内部使用AutoMapper进行转换。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Mapper.CreateMap&lt;Person, PersonDto&gt;();</div></pre></td></tr></table></figure></p>
<p>要获取有关AutoMapper的更多信息，请参阅它的网站。 其他应用程序服务是TaskAppService实现如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">public class TaskAppService : ApplicationService, ITaskAppService</div><div class="line">&#123;</div><div class="line">    //These members set in constructor using constructor injection.</div><div class="line">        </div><div class="line">    private readonly ITaskRepository _taskRepository;</div><div class="line">    private readonly IRepository&lt;Person&gt; _personRepository;</div><div class="line">        </div><div class="line">    /// &lt;summary&gt;</div><div class="line">    ///In constructor, we can get needed classes/interfaces.</div><div class="line">    ///They are sent here by dependency injection system automatically.</div><div class="line">    /// &lt;/summary&gt;</div><div class="line">    public TaskAppService(ITaskRepository taskRepository, IRepository&lt;Person&gt; personRepository)</div><div class="line">    &#123;</div><div class="line">        _taskRepository = taskRepository;</div><div class="line">        _personRepository = personRepository;</div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    public GetTasksOutput GetTasks(GetTasksInput input)</div><div class="line">    &#123;</div><div class="line">        //Called specific GetAllWithPeople method of task repository.</div><div class="line">        var tasks = _taskRepository.GetAllWithPeople(input.AssignedPersonId, input.State);</div><div class="line"></div><div class="line">        //Used AutoMapper to automatically convert List&lt;Task&gt; to List&lt;TaskDto&gt;.</div><div class="line">        return new GetTasksOutput</div><div class="line">                &#123;</div><div class="line">                    Tasks = Mapper.Map&lt;List&lt;TaskDto&gt;&gt;(tasks)</div><div class="line">                &#125;;</div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    public void UpdateTask(UpdateTaskInput input)</div><div class="line">    &#123;</div><div class="line">        //We can use Logger, it&apos;s defined in ApplicationService base class.</div><div class="line">        Logger.Info(&quot;Updating a task for input: &quot; + input);</div><div class="line"></div><div class="line">        //Retrieving a task entity with given id using standard Get method of repositories.</div><div class="line">        var task = _taskRepository.Get(input.TaskId);</div><div class="line"></div><div class="line">        //Updating changed properties of the retrieved task entity.</div><div class="line"></div><div class="line">        if (input.State.HasValue)</div><div class="line">        &#123;</div><div class="line">            task.State = input.State.Value;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (input.AssignedPersonId.HasValue)</div><div class="line">        &#123;</div><div class="line">            task.AssignedPerson = _personRepository.Load(input.AssignedPersonId.Value);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //We even do not call Update method of the repository.</div><div class="line">        //Because an application service method is a &apos;unit of work&apos; scope as default.</div><div class="line">        //ABP automatically saves all changes when a &apos;unit of work&apos; scope ends (without any exception).</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void CreateTask(CreateTaskInput input)</div><div class="line">    &#123;</div><div class="line">        //We can use Logger, it&apos;s defined in ApplicationService class.</div><div class="line">        Logger.Info(&quot;Creating a task for input: &quot; + input);</div><div class="line"></div><div class="line">        //Creating a new Task entity with given input&apos;s properties</div><div class="line">        var task = new Task &#123; Description = input.Description &#125;;</div><div class="line"></div><div class="line">        if (input.AssignedPersonId.HasValue)</div><div class="line">        &#123;</div><div class="line">            task.AssignedPersonId = input.AssignedPersonId.Value;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //Saving entity with standard Insert method of repositories.</div><div class="line">        _taskRepository.Insert(task);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在UpdateTask方法中，我从任务存储库获取任务实体，并设置更改的属性。 状态或/和AssignedPersonId可能会更改。 请注意，我没有调用_taskRepository.Update或任何其他方法来保存对数据库的更改。 因为在ASP.NET Boilerplate中，应用程序服务方法是默认的工作单元。 对于单位工作方法，它基本上打开数据库连接，并在方法开始时开始事务，并在方法结束时将所有更改（提交事务）保存到数据库。 如果在方法的执行中抛出异常，它将回滚事务。 如果一个工作单元的方法调用另一个工作单元方法，则它们使用相同的事务。 第一个称为工作单位的方法自动处理连接和事务管理。</p>
<p>要了解有关ASP.NET Boilerplate中工作单元的更多信息，请参阅文档。</p>
<h3 id="数据传输对象验证-DTO-Validation"><a href="#数据传输对象验证-DTO-Validation" class="headerlink" title="数据传输对象验证(DTO Validation)"></a>数据传输对象验证(DTO Validation)</h3><p>验证在应用程序开发中是一个重要且关键但有点乏味的概念。 ABP提供基础设施，使验证更容易和更好。 验证用户输入是一个应用层任务。 如果给定输入无效，则应用程序服务方法应验证输入并抛出异常。 ASP.NET MVC和Web API具有内置的验证系统，可以使用数据注释（如Required）来实现。 但是应用程序服务是一个简单的类，不是从Controller派生的。 幸运的是，ABP为普通应用服务方法提供了类似的机制（使用Castle Dynamic代理和拦截）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class CreateTaskInput</div><div class="line">&#123;</div><div class="line">    public int? AssignedPersonId &#123; get; set; &#125;</div><div class="line"></div><div class="line">    [Required]</div><div class="line">    public string Description &#123; get; set; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在此输入DTO中，只需要“描述”属性。 在调用应用程序服务方法之前，ABP会自动检查它，如果它为空或为空则抛出异常。 System.ComponentModel.DataAnnotations命名空间中的所有验证属性都可以在这里使用。 如果这些标准属性对你来说还不够，可以实现ICustomValidate：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class CreateTaskInput : IInputDto, ICustomValidate</div><div class="line">&#123;</div><div class="line">    public int? AssignedPersonId &#123; get; set; &#125;</div><div class="line"></div><div class="line">    public bool SendEmailToAssignedPerson &#123; get; set; &#125;</div><div class="line"></div><div class="line">    [Required]</div><div class="line">    public string Description &#123; get; set; &#125;</div><div class="line"></div><div class="line">    public void AddValidationErrors(List&lt;ValidationResult&gt; results)</div><div class="line">    &#123;</div><div class="line">        if (SendEmailToAssignedPerson &amp;&amp; (!AssignedPersonId.HasValue || AssignedPersonId.Value &lt;= 0))</div><div class="line">        &#123;</div><div class="line">            results.Add(new ValidationResult(&quot;AssignedPersonId must be set if SendEmailToAssignedPerson is true!&quot;));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>还有一件事：ABP检查服务方法的输入参数是否为空。 所以，你不需要写保护条款。</p>
<p>我建议为每个应用程序服务方法创建分离的输入和输出类，即使它只有一个输入参数。 当通过向该方法添加其他参数来扩展应用程序时，这是很好的。 它提供了一种在不破坏现有客户端的情况下向应用程序服务方法添加参数的方法。</p>
<h2 id="动态Web-API控制器-Dynamic-Web-API-Controllers"><a href="#动态Web-API控制器-Dynamic-Web-API-Controllers" class="headerlink" title="动态Web API控制器(Dynamic Web API Controllers)"></a>动态Web API控制器(Dynamic Web API Controllers)</h2><p>应用程序服务由表示层消耗。 在单页面应用程序中，所有的数据都是使用AJAX在javascript和服务器之间发送/接收的。 ABP极大地简化了从javascript调用应用程序服务方法。 这是怎么做到的 让我来解释一下</p>
<p>一个应用程序服务不能直接通过javascript调用。 我们可以使用ASP.NET Web API来向客户端公开服务（还有许多其他框架，如Web服务，WCF，SignalR等）。 所以，可能会有这样的一个流程：</p>
<p><img src="https://www.codeproject.com/KB/aspnet/768664/calling_webapi_ajax.png" alt="calling_webapi_ajax"></p>
<p>Javascript通过AJAX调用Web API控件的操作，Web API控制器的操作然后调用相应的应用程序服务的方法，获取结果并返回给客户端。 这很漂亮的机器人。 ABP自动执行此操作，并可为应用程序服务动态创建Web API控制器。 这里是为我的应用服务创建Web API控制器的所有代码：任务服务和个人服务：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">DynamicApiControllerBuilder</div><div class="line">    .ForAll&lt;IApplicationService&gt;(Assembly.GetAssembly(typeof (SimpleTaskSystemApplicationModule)), &quot;tasksystem&quot;)</div><div class="line">    .Build();</div></pre></td></tr></table></figure></p>
<p>因此，使用ASP.NET Web API（ABP流畅的动态控制器创建API支持从Web API隐藏方法或选择特定应用程序服务，自己尝试），任务和个人应用程序服务的所有方法都暴露给客户端。 在演示层部分，我们将看到如何使用ABP的动态JavaScript代理调用这些Web API控制器。</p>
<h2 id="显示层-Presentation-layer"><a href="#显示层-Presentation-layer" class="headerlink" title="显示层(Presentation layer)"></a>显示层(Presentation layer)</h2><p>“负责向用户显示信息并解释用户的命令”（Eric Evans）。 DDD中最明显的一层是Presentation Layer，因为我们可以看到它，我们可以点击它:)。</p>
<h3 id="单页应用-Single-page-applications"><a href="#单页应用-Single-page-applications" class="headerlink" title="单页应用(Single page applications)"></a>单页应用(Single page applications)</h3><p> 维基百科说SPA：</p>
<ol>
<li><p>单页面应用程序（SPA）也称为单页面接口（SPI），是一个适用于单个网页的Web应用程序或网站，目标是提供类似桌面应用程序的更流畅的用户体验。</p>
</li>
<li><p>在SPA中，通过单个页面加载检索所有必需的代码（HTML，JavaScript和CSS），或者根据需要动态加载适当的资源并将其添加到页面，通常是响应用户操作。 尽管现代网络技术（如HTML5中包含的）技术可以在应用程序中提供单独逻辑页面的感知和导航性，但该页面在此过程中的任何时间点都不会重新加载，也不会将其转移到其他页面。 与单页应用程序的交互通常涉及与Web服务器的幕后动态通信。</p>
</li>
</ol>
<p>有许多框架和库提供了构建SPA的基础设施。 ASP.NET Boilerplate可以与任何SPA框架一起使用，但可以提供简单的基础设施，以便与DurandalJs和AngularJs配合使用（请参阅AngularJs开发的相同应用程序）。</p>
<p>Durandal [7]是这些框架之一，我认为这是一个非常成功的开源项目。 它基于成功和大多数使用的项目：jQuery（用于DOM操作和AJAX），knockout.js（用于MVVM，使用HTML绑定JavaScript模型）和require.js（用于管理javascript依赖关系并从服务器动态加载javascript）。 有关更多信息和丰富的文档，请访问Durandal的网站。</p>
<h3 id="本地化"><a href="#本地化" class="headerlink" title="本地化"></a>本地化</h3><p>ABP提供了一个强大而灵活的本地化系统。你可以存储在资源文件，XML文件，甚至在自定义源您的本地化的文本。在本节中，我将展示使用XML文件。简单的任务系统项目包括本地化文件夹中的XML文件：</p>
<p><img src="https://www.codeproject.com/KB/aspnet/768664/localization_files2.png" alt="localization_files2"></p>
<p>在这里，SimpleTaskSystem.xml的内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</div><div class="line">&lt;localizationDictionary culture=&quot;en&quot;&gt;</div><div class="line">  &lt;texts&gt;</div><div class="line">    &lt;text name=&quot;TaskSystem&quot; value=&quot;Task System&quot; /&gt;</div><div class="line">    &lt;text name=&quot;TaskList&quot; value=&quot;Task List&quot; /&gt;</div><div class="line">    &lt;text name=&quot;NewTask&quot; value=&quot;New Task&quot; /&gt;</div><div class="line">    &lt;text name=&quot;Xtasks&quot; value=&quot;&#123;0&#125; tasks&quot; /&gt;</div><div class="line">    &lt;text name=&quot;AllTasks&quot; value=&quot;All tasks&quot; /&gt;</div><div class="line">    &lt;text name=&quot;ActiveTasks&quot; value=&quot;Active tasks&quot; /&gt;</div><div class="line">    &lt;text name=&quot;CompletedTasks&quot; value=&quot;Completed tasks&quot; /&gt;</div><div class="line">    &lt;text name=&quot;TaskDescription&quot; value=&quot;Task description&quot; /&gt;</div><div class="line">    &lt;text name=&quot;EnterDescriptionHere&quot; value=&quot;Task description&quot; /&gt;</div><div class="line">    &lt;text name=&quot;AssignTo&quot; value=&quot;Assign to&quot; /&gt;</div><div class="line">    &lt;text name=&quot;SelectPerson&quot; value=&quot;Select person&quot; /&gt;</div><div class="line">    &lt;text name=&quot;CreateTheTask&quot; value=&quot;Create the task&quot; /&gt;</div><div class="line">    &lt;text name=&quot;TaskUpdatedMessage&quot; value=&quot;Task has been successfully updated.&quot; /&gt;</div><div class="line">    &lt;text name=&quot;TaskCreatedMessage&quot; value=&quot;Task &#123;0&#125; has been created successfully.&quot; /&gt;</div><div class="line">  &lt;/texts&gt;</div><div class="line">&lt;/localizationDictionary&gt;</div></pre></td></tr></table></figure></p>
<p>这是一个简单的XML文件，包括所有可本地化文本的名称 - 值对。 文化属性定义文件的文化。 在解决方案中还有一个土耳其语（tr）本地化的XML文件。 本地化文件应该注册到ABP，以便可以在C＃和javascript中使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Configuration.Localization.Sources.Add(</div><div class="line">    new XmlLocalizationSource(</div><div class="line">        &quot;SimpleTaskSystem&quot;,</div><div class="line">        HttpContext.Current.Server.MapPath(&quot;~/Localization/SimpleTaskSystem&quot;)</div><div class="line">        )</div><div class="line">    );</div></pre></td></tr></table></figure></p>
<p>本地化源必须是唯一的名称（SimpleTaskSystem这里）。 因此，可以在应用程序中使用不同的源（以不同的格式和数据源存储）。 XmlLocalizationSource还需要一个文件夹（/ Localization / SimpleTaskSystem here）来读取本地化文件。</p>
<p>然后我们可以在需要时获得本地化的文本。 在C＃中，我们有两个选项来获取本地化文本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//Use directly</div><div class="line">var s1 = LocalizationHelper.GetString(&quot;SimpleTaskSystem&quot;, &quot;NewTask&quot;);</div><div class="line"></div><div class="line">//Use after get source</div><div class="line">var source = LocalizationHelper.GetSource(&quot;SimpleTaskSystem&quot;);</div><div class="line">var s2 = source.GetString(&quot;NewTask&quot;);</div></pre></td></tr></table></figure></p>
<p>它（通过使用当前线程的CurrentUICulture）返回当前语言本地化的文本。还有覆盖在一个特定的文化得到文本。有一个在JavaScript中的类似的API，以获得本地化的文本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//Use directly</div><div class="line">var s1 = abp.localization.localize(&apos;NewTask&apos;, &apos;SimpleTaskSystem&apos;);</div><div class="line"></div><div class="line">//Use after get source</div><div class="line">var source = abp.localization.getSource(&apos;SimpleTaskSystem&apos;);</div><div class="line">var s2 = source(&apos;NewTask&apos;);</div></pre></td></tr></table></figure></p>
<p>这些方法还获得当前语言的本地化的文本。</p>
<h2 id="Javascript-API"><a href="#Javascript-API" class="headerlink" title="Javascript API"></a>Javascript API</h2><p>在javascript中，客户端每个应用程序都需要一些常见的功能。 例如：显示成功通知，阻止ui元素，显示消息框等。 存在很多库（jQuery插件）。 但是他们都有不同的API。 ASP.NET Boilerplate为这些任务定义了一些常见的API。 因此，如果您以后要更改通知插件，则只能实现一个简单的API。 此外，jQuery插件可以直接实现ABP API。 您可以调用ABP的通知API而不是直接调用插件的通知API。 在这里，我将解释一些API。</p>
<h3 id="日志记录API"><a href="#日志记录API" class="headerlink" title="日志记录API"></a>日志记录API</h3><p>当你想要写一些简单的日志中的客户端，你可以如你所知使用的console.log（“…”）API。但它不是所有的浏览器都支持，你的脚本可能被打破。所以，你应该先检查一下。此外，您可能想要写日志别处。 ABP定义安全日志记录功能：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">abp.log.debug(&apos;...&apos;);</div><div class="line">abp.log.info(&apos;...&apos;);</div><div class="line">abp.log.warn(&apos;...&apos;);</div><div class="line">abp.log.error(&apos;...&apos;);</div><div class="line">abp.log.fatal(&apos;...&apos;);</div></pre></td></tr></table></figure></p>
<p>此外，您还可以通过abp.log.level设置abp.log.levels的一个改变日志级别（例如：abp.log.levels.INFO到不写调试日志）。这些函数写日志，在默认情况下控制台。但是你可以很容易地覆盖这个行为。</p>
<h3 id="通知API"><a href="#通知API" class="headerlink" title="通知API"></a>通知API</h3><p>当事情发生时，我们喜欢显示一些奇特的自动消失通知，例如在保存项目或出现问题时。 ABP定义了API：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">abp.notify.success(&apos;a message text&apos;, &apos;optional title&apos;);</div><div class="line">abp.notify.info(&apos;a message text&apos;, &apos;optional title&apos;);</div><div class="line">abp.notify.warn(&apos;a message text&apos;, &apos;optional title&apos;);</div><div class="line">abp.notify.error(&apos;a message text&apos;, &apos;optional title&apos;);</div></pre></td></tr></table></figure></p>
<p>通知API由默认toastr库实现。您可以在自己喜欢的通知库实现它。</p>
<h3 id="MessageBox-API"><a href="#MessageBox-API" class="headerlink" title="MessageBox API"></a>MessageBox API</h3><p>MessageBox API用于显示一个消息给用户。用户点击OK，关闭消息窗口/对话框。例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">abp.message.info(&apos;some info message&apos;, &apos;some optional title&apos;);</div><div class="line">abp.message.warn(&apos;some warning message&apos;, &apos;some optional title&apos;);</div><div class="line">abp.message.error(&apos;some error message&apos;, &apos;some optional title&apos;);</div></pre></td></tr></table></figure></p>
<p>它是目前不能实现。您可以实现它显示一个对话框或消息框。</p>
<h3 id="UI-Block-API"><a href="#UI-Block-API" class="headerlink" title="UI Block API"></a>UI Block API</h3><p>此API用于阻止整个页面或页面上的元素。因此，用户不能点击它。 ABP API的是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">abp.ui.block(); //Block all page</div><div class="line">abp.ui.block($(&apos;#MyDivElement&apos;)); //You can use any jQuery selection..</div><div class="line">abp.ui.block(&apos;#MyDivElement&apos;); //..or directly selector</div><div class="line">abp.ui.unblock(); //Unblock all page</div><div class="line">abp.ui.unblock(&apos;#MyDivElement&apos;); //Unblock specific element</div></pre></td></tr></table></figure></p>
<h3 id="UI-Busy-API"><a href="#UI-Busy-API" class="headerlink" title="UI Busy API"></a>UI Busy API</h3><p>有时你可能需要做一些页面/元素忙。例如，你可能想阻止一个表格，然后让一个忙碌的指标，同时提交表单到服务器。 ABP提供API为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">abp.ui.setBusy(&apos;#MyRegisterForm&apos;);</div><div class="line">abp.ui.clearBusy(&apos;#MyRegisterForm&apos;);</div></pre></td></tr></table></figure></p>
<p>setBusy可以采取承诺的第二个参数来自动调用clearBusy时承诺完成。请参见newtask视图模型示例项目（和文章）的使用。</p>
<h2 id="模块系统"><a href="#模块系统" class="headerlink" title="模块系统"></a>模块系统</h2><p>Abp的设计是模块化的。它提供了基础设施来创建通用模块那些可以在不同的应用中使用。一个模块可以依赖于其他模块。一个应用程序是由模块组成。模块是包括从AbpModule衍生的模块类的组件。在示例应用程序在这篇文章中所解释的，所有层被定义为分隔模块。例如，应用层定义那样的模块：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/// &lt;summary&gt;</div><div class="line">/// &apos;Application layer module&apos; for this project.</div><div class="line">/// &lt;/summary&gt;</div><div class="line">[DependsOn(typeof(SimpleTaskSystemCoreModule))]</div><div class="line">public class SimpleTaskSystemApplicationModule : AbpModule</div><div class="line">&#123;</div><div class="line">    public override void Initialize()</div><div class="line">    &#123;</div><div class="line">        //This code is used to register classes to dependency injection system for this assembly using conventions.</div><div class="line">        IocManager.RegisterAssemblyByConvention(Assembly.GetExecutingAssembly());</div><div class="line"></div><div class="line">        //We must declare mappings to be able to use AutoMapper</div><div class="line">        DtoMappings.Map();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Abp分别在应用程序启动时调用模块PreInitialize，Initialize和PostInitialize方法。 如果模块A依赖于模块B，模块B在模块A之前初始化。所有方法的准确顺序：PreInitialize-B，PreInitialize-A，Initialize-B，Initialize-A，PostInitialize-B和PostInitialize-A。 所有依赖图都是这样的。</p>
<p>Initialize是应该放置依赖注入配置的方法。 在这里，您将看到该模块以常规方式注册其组装中的所有类（请参阅下一节）。 然后它使用AutoMapper库映射类（它是此应用程序的特定的）。 该模块还定义依赖关系（应用程序层仅依赖于应用程序的域（核心）层）。</p>
<h2 id="依赖注入和惯例"><a href="#依赖注入和惯例" class="headerlink" title="依赖注入和惯例"></a>依赖注入和惯例</h2><p>当你写遵循最佳实践和一些约定您的应用程序ASP.NET样板几乎使无形的使用依赖注入系统。它会自动注册所有存储库，域名服务，应用服务，自动MVC控制器和Web API控制器。例如，你可能有一个IPersonAppService接口和实现它PersonAppService类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public interface IPersonAppService : IApplicationService</div><div class="line">&#123;</div><div class="line">    //...</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class PersonAppService : IPersonAppService</div><div class="line">&#123;</div><div class="line">    //...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ASP.NET Boilerplate自动注册它，因为它实现了IApplicationService接口（它只是一个空的接口）。 它被注册为transient（每个用法创建的实例）。 当您注册（使用构造函数注入）IPersonAppService接口到一个类时，将创建一个PersonAppService对象并自动传递到构造函数中。 请参阅有关依赖注入的详细文档，并在ASP.NET Boilerplate中实现。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>Abp提供了一个基于DDD的一款优秀的asp.net框架，提供了基本基本常用的api,可以让开发者只关注具体的业务逻辑,省去了很多重复造轮子的工作，虽然abp为开发者提供了创建项目的一个好的模块、入口的基本框架。但abp也对开发者本身所掌握的知识和经验有一定的要求，如果你使用abp作为你项目的框架,同时意味着你必须熟悉DDD知识并且拥有一定的经验。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechatpay.JPG" alt="谢晖 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay.JPG" alt="谢晖 Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ASP-NET/" rel="tag"># ASP.NET</a>
          
            <a href="/tags/DDD/" rel="tag"># DDD</a>
          
            <a href="/tags/ABP/" rel="tag"># ABP</a>
          
            <a href="/tags/领域驱动设计/" rel="tag"># 领域驱动设计</a>
          
            <a href="/tags/ASP-NET-Boilerplate/" rel="tag"># ASP.NET Boilerplate</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/15/IdentityServer介绍/" rel="next" title="IdentityServer介绍">
                <i class="fa fa-chevron-left"></i> IdentityServer介绍
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/09/领域驱动设计-DDD-Domain-Driven-Design/" rel="prev" title="领域驱动设计(DDD:Domain-Driven Design)">
                领域驱动设计(DDD:Domain-Driven Design) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/me.jpg"
               alt="谢晖" />
          <p class="site-author-name" itemprop="name">谢晖</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#背景"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#什么是ASP-NET-Boilerplate（ABP）？"><span class="nav-number">2.</span> <span class="nav-text">什么是ASP.NET Boilerplate（ABP）？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务端-Server-side"><span class="nav-number">2.0.1.</span> <span class="nav-text">服务端(Server side)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#客户端-Client-side"><span class="nav-number">2.0.2.</span> <span class="nav-text">客户端(Client side)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ABP不是什么？"><span class="nav-number">3.</span> <span class="nav-text">ABP不是什么？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#入门-Getting-started"><span class="nav-number">4.</span> <span class="nav-text">入门(Getting started)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#从模板创建空的web应用程序"><span class="nav-number">4.1.</span> <span class="nav-text">从模板创建空的web应用程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#领域层-Domain-layer"><span class="nav-number">4.2.</span> <span class="nav-text">领域层(Domain layer)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#实体-Entities"><span class="nav-number">4.2.1.</span> <span class="nav-text">实体(Entities)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#仓储-Repositories"><span class="nav-number">4.2.2.</span> <span class="nav-text">仓储(Repositories)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基础设施层-Infrastructure-layer"><span class="nav-number">4.3.</span> <span class="nav-text">基础设施层(Infrastructure layer)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库迁移-Database-Migrations"><span class="nav-number">4.3.1.</span> <span class="nav-text">数据库迁移(Database Migrations)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实体映射-Entity-mappings"><span class="nav-number">4.3.2.</span> <span class="nav-text">实体映射(Entity mappings)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#仓储实现"><span class="nav-number">4.3.3.</span> <span class="nav-text">仓储实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用层-Application-layer"><span class="nav-number">4.4.</span> <span class="nav-text">应用层(Application layer)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#应用服务和数据传输对象（DTO）"><span class="nav-number">4.4.1.</span> <span class="nav-text">应用服务和数据传输对象（DTO）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据传输对象验证-DTO-Validation"><span class="nav-number">4.4.2.</span> <span class="nav-text">数据传输对象验证(DTO Validation)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态Web-API控制器-Dynamic-Web-API-Controllers"><span class="nav-number">4.5.</span> <span class="nav-text">动态Web API控制器(Dynamic Web API Controllers)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#显示层-Presentation-layer"><span class="nav-number">4.6.</span> <span class="nav-text">显示层(Presentation layer)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单页应用-Single-page-applications"><span class="nav-number">4.6.1.</span> <span class="nav-text">单页应用(Single page applications)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#本地化"><span class="nav-number">4.6.2.</span> <span class="nav-text">本地化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Javascript-API"><span class="nav-number">4.7.</span> <span class="nav-text">Javascript API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#日志记录API"><span class="nav-number">4.7.1.</span> <span class="nav-text">日志记录API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通知API"><span class="nav-number">4.7.2.</span> <span class="nav-text">通知API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MessageBox-API"><span class="nav-number">4.7.3.</span> <span class="nav-text">MessageBox API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UI-Block-API"><span class="nav-number">4.7.4.</span> <span class="nav-text">UI Block API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UI-Busy-API"><span class="nav-number">4.7.5.</span> <span class="nav-text">UI Busy API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模块系统"><span class="nav-number">4.8.</span> <span class="nav-text">模块系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖注入和惯例"><span class="nav-number">4.9.</span> <span class="nav-text">依赖注入和惯例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">谢晖</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  










  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://coderpreacher.disqus.com.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2017/05/10/ASP-NET-Boilerplate（ABP）介绍/';
          this.page.identifier = '2017/05/10/ASP-NET-Boilerplate（ABP）介绍/';
          this.page.title = 'ASP.NET Boilerplate（ABP）介绍';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://coderpreacher.disqus.com.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === '') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.0"></script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.0"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.0"></script>


  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.0"></script>


</body>
</html>
